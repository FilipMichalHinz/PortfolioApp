<div class="detail-container">

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-spinner">
    Loading portfolio...
  </div>

  <!-- üß† Full page only shown when loading is finished -->
  <ng-container *ngIf="!isLoading">

    <!-- üîπ Header -->
    <header class="detail-header">
      <button class="back-btn" routerLink="/portfolio-list">‚Üê Back</button>
      <h1 class="title">
        {{ portfolio.portfolioName || ('Portfolio ' + summary.portfolioId) }}
      </h1>
    </header>

    <!-- üîπ Charts -->
    <section class="charts-panel">
      <div class="chart-placeholder line-chart">Performance Chart</div>
      <div class="chart-placeholder pie-chart">Allocation Pie</div>
    </section>

    <!-- üîπ Metrics -->
    <section class="metrics-panel">
      <div class="metric-card">
        <div class="label">Invested</div>
        <div class="value">{{ summary.initialInvestment | currency }}</div>
      </div>
      <div class="metric-card">
        <div class="label">Current Value</div>
        <div class="value">{{ summary.currentValue | currency }}</div>
      </div>
      <div class="metric-card">
        <div class="label">Total P/L</div>
        <div class="value" [class.positive]="summary.totalProfitLoss >= 0"
          [class.negative]="summary.totalProfitLoss < 0">
          {{ summary.totalProfitLoss | currency }}
          <span class="pct">({{ summary.changePercent | number:'1.0-0' }}%)</span>
        </div>
      </div>
    </section>

    <!-- üîπ Assets Breakdown -->
    <section class="assets-panel">
      <h2 class="assets-header">Assets Breakdown</h2>

      <div class="add-item-wrapper">
        <button class="add-btn" *ngIf="!showForm" (click)="showForm = true">+ Add Item</button>
      </div>

      <div *ngIf="showForm">
        <app-portfolio-item-form 
          [portfolioId]="portfolio.id"
          (created)="onItemCreated($event)"
          (cancel)="onCancel()">
        </app-portfolio-item-form>
      </div>

      <div *ngIf="summary.byAsset.length === 0 && !showForm" class="no-assets-placeholder">
        No assets yet ‚Äî start by adding your first item!
      </div>

      <table *ngIf="summary.byAsset.length > 0">
        <thead>
          <tr>
            <th>Name</th> <!-- üß† First column is now Name -->
            <th>Ticker</th> <!-- üß† Then Ticker -->
            <th>Qty</th>
            <th>Buy Price</th>
            <th>Current Price</th>
            <th>Value</th>
            <th>P/L</th>
            <th>Œî%</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let a of summary.byAsset">
            <td>{{ a.name ? a.name : 'Loading...' }}</td> <!-- üß† Show Name first -->
            <td>{{ a.ticker }}</td> <!-- üß† Ticker second -->
            <td>{{ a.quantity }}</td>
            <td>{{ a.purchasePrice | currency }}</td>
            <td>{{ a.currentPrice | currency }}</td>
            <td>{{ a.currentValue | currency }}</td>
            <td [class.positive]="a.profitLoss >= 0" [class.negative]="a.profitLoss < 0">
              {{ a.profitLoss | currency }}
            </td>
            <td>{{ a.changePercent | number:'1.0-0' }}%</td>
          </tr>
        </tbody>
      </table>          
    </section>

  </ng-container>

</div>
